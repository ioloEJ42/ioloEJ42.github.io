<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portfolio Content Editor</title>
    <style>
      /* Minimal styling for maximum efficiency */
      body {
        font-family: system-ui, -apple-system, sans-serif;
        margin: 0;
        padding: 20px;
        line-height: 1.5;
        max-width: 1200px;
        margin: 0 auto;
        color: #333;
      }

      header {
        margin-bottom: 20px;
        border-bottom: 1px solid #ddd;
        padding-bottom: 10px;
      }

      .tabs {
        display: flex;
        margin-bottom: 20px;
      }

      .tab {
        padding: 8px 16px;
        border: 1px solid #ccc;
        background: #f5f5f5;
        cursor: pointer;
        margin-right: 5px;
      }

      .tab.active {
        background: #1a73e8;
        color: white;
        border-color: #1a73e8;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      h1,
      h2,
      h3 {
        margin-top: 0;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        font-family: inherit;
      }

      button {
        padding: 8px 16px;
        background: #1a73e8;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
      }

      button.secondary {
        background: #f5f5f5;
        color: #333;
        border: 1px solid #ccc;
      }

      button.danger {
        background: #d93025;
      }

      textarea {
        min-height: 200px;
      }

      .form-section {
        margin-bottom: 20px;
      }

      .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 5px;
      }

      .tag {
        background: #e8f0fe;
        border: 1px solid #aec9ff;
        border-radius: 4px;
        padding: 2px 8px;
        display: flex;
        align-items: center;
      }

      .tag-remove {
        margin-left: 5px;
        cursor: pointer;
        color: #666;
      }

      .preview {
        border: 1px solid #ddd;
        padding: 15px;
        margin-top: 20px;
        border-radius: 4px;
        background: #f9f9f9;
        overflow-x: auto;
      }

      .toolbar {
        background: #f5f5f5;
        padding: 5px;
        margin-bottom: 0;
        border: 1px solid #ccc;
        border-bottom: none;
        border-radius: 4px 4px 0 0;
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
      }

      .toolbar button {
        margin: 0;
        padding: 4px 8px;
        font-size: 12px;
      }

      .editor-container {
        margin-bottom: 20px;
      }

      .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 20px;
        background: #323232;
        color: white;
        border-radius: 4px;
        opacity: 0;
        transition: opacity 0.3s;
        z-index: 1000;
      }

      .notification.show {
        opacity: 1;
      }

      .notification.error {
        background: #d93025;
      }

      .list-container {
        margin-bottom: 20px;
      }

      .list-item {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-bottom: 10px;
      }

      .tags {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 5px;
      }

      .tag-pill {
        background: #e8f0fe;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }

      small {
        color: #666;
        display: block;
        margin-top: 2px;
      }

      .btn-group {
        margin-top: 20px;
        display: flex;
        gap: 10px;
      }

      pre {
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Portfolio Content Editor</h1>
      <p>Create and edit content for your portfolio site</p>
    </header>

    <div class="tabs">
      <div class="tab active" data-tab="projects">Projects</div>
      <div class="tab" data-tab="blogs">Blogs</div>
    </div>

    <!-- Projects Tab -->
    <div id="projects-tab" class="tab-content active">
      <div id="projects-list" class="list-container">
        <p id="projects-loading">Loading projects...</p>
      </div>

      <div class="btn-group">
        <button id="new-project-btn">New Project</button>
        <button id="load-project-btn" class="secondary">
          Load Selected Project
        </button>
      </div>

      <div id="project-form-container" style="display: none">
        <h2 id="project-form-title">New Project</h2>

        <form id="project-form">
          <div class="form-section">
            <h3>Metadata (projects.json)</h3>

            <div class="form-group">
              <label for="project-id">Project ID</label>
              <input
                type="text"
                id="project-id"
                required
                placeholder="project-name-slug"
              />
              <small
                >Use lowercase letters, numbers and hyphens only. This will be
                used in URLs.</small
              >
            </div>

            <div class="form-group">
              <label for="project-title">Title</label>
              <input
                type="text"
                id="project-title"
                required
                placeholder="Project Title"
              />
            </div>

            <div class="form-group">
              <label for="project-description">Short Description</label>
              <textarea
                id="project-description"
                required
                placeholder="A brief description for project listings"
                rows="3"
              ></textarea>
            </div>

            <div class="form-group">
              <label>
                <input type="checkbox" id="project-featured" />
                Featured Project (shown on homepage)
              </label>
            </div>

            <div class="form-group">
              <label for="project-tags-input">Tags</label>
              <div style="display: flex; gap: 10px">
                <input
                  type="text"
                  id="project-tags-input"
                  placeholder="Add tag and press Enter"
                />
                <button type="button" id="add-project-tag" class="secondary">
                  Add
                </button>
              </div>
              <div id="project-tags-container" class="tags-container"></div>
            </div>
          </div>

          <div class="form-section">
            <h3>Content (projects/[id].json)</h3>

            <div class="form-group">
              <label for="project-date">Date</label>
              <input type="date" id="project-date" required />
            </div>

            <div class="form-group">
              <label for="project-github">GitHub URL (optional)</label>
              <input
                type="url"
                id="project-github"
                placeholder="https://github.com/username/repo"
              />
            </div>

            <div class="form-group">
              <label for="project-live">Live Demo URL (optional)</label>
              <input
                type="url"
                id="project-live"
                placeholder="https://example.com"
              />
            </div>

            <div class="form-group">
              <label for="project-content">Full HTML Content</label>
              <div class="editor-container">
                <div class="toolbar">
                  <button type="button" data-format="h2">H2</button>
                  <button type="button" data-format="h3">H3</button>
                  <button type="button" data-format="p">P</button>
                  <button type="button" data-format="strong">Bold</button>
                  <button type="button" data-format="em">Italic</button>
                  <button type="button" data-format="ul">List</button>
                  <button type="button" data-format="ol">Numbered List</button>
                  <button type="button" data-format="li">List Item</button>
                  <button type="button" data-format="a">Link</button>
                  <button type="button" data-format="code">Code</button>
                </div>
                <textarea
                  id="project-content"
                  required
                  placeholder="<p>Project full description with HTML formatting</p>"
                ></textarea>
              </div>
            </div>
          </div>

          <div class="btn-group">
            <button type="button" id="preview-project-btn" class="secondary">
              Preview JSON
            </button>
            <button type="button" id="save-project-btn">
              Generate & Download JSON Files
            </button>
            <button type="button" id="cancel-project-btn" class="danger">
              Cancel
            </button>
          </div>
        </form>

        <div id="project-preview" class="preview" style="display: none">
          <h3>JSON Preview</h3>
          <h4>projects.json entry:</h4>
          <pre id="project-meta-preview"></pre>

          <h4>projects/[id].json file:</h4>
          <pre id="project-content-preview"></pre>

          <div class="btn-group">
            <button id="close-project-preview-btn" class="secondary">
              Close Preview
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Blogs Tab -->
    <div id="blogs-tab" class="tab-content">
      <div id="blogs-list" class="list-container">
        <p id="blogs-loading">Loading blog posts...</p>
      </div>

      <div class="btn-group">
        <button id="new-blog-btn">New Blog Post</button>
        <button id="load-blog-btn" class="secondary">Load Selected Post</button>
      </div>

      <div id="blog-form-container" style="display: none">
        <h2 id="blog-form-title">New Blog Post</h2>

        <form id="blog-form">
          <div class="form-section">
            <h3>Metadata (blogs.json)</h3>

            <div class="form-group">
              <label for="blog-id">Blog Post ID</label>
              <input
                type="text"
                id="blog-id"
                required
                placeholder="blog-post-slug"
              />
              <small
                >Use lowercase letters, numbers and hyphens only. This will be
                used in URLs.</small
              >
            </div>

            <div class="form-group">
              <label for="blog-title">Title</label>
              <input
                type="text"
                id="blog-title"
                required
                placeholder="Blog Post Title"
              />
            </div>

            <div class="form-group">
              <label for="blog-date">Date</label>
              <input
                type="text"
                id="blog-date"
                required
                placeholder="February 28, 2025"
              />
            </div>

            <div class="form-group">
              <label for="blog-author">Author</label>
              <input
                type="text"
                id="blog-author"
                required
                placeholder="Your Name"
              />
            </div>

            <div class="form-group">
              <label for="blog-excerpt">Excerpt</label>
              <textarea
                id="blog-excerpt"
                required
                placeholder="A brief excerpt for blog listings"
                rows="3"
              ></textarea>
            </div>

            <div class="form-group">
              <label for="blog-tags-input">Tags</label>
              <div style="display: flex; gap: 10px">
                <input
                  type="text"
                  id="blog-tags-input"
                  placeholder="Add tag and press Enter"
                />
                <button type="button" id="add-blog-tag" class="secondary">
                  Add
                </button>
              </div>
              <div id="blog-tags-container" class="tags-container"></div>
            </div>
          </div>

          <div class="form-section">
            <h3>Content (blogs/[id].json)</h3>

            <div class="form-group">
              <label for="blog-content">Full HTML Content</label>
              <div class="editor-container">
                <div class="toolbar">
                  <button type="button" data-format="h2">H2</button>
                  <button type="button" data-format="h3">H3</button>
                  <button type="button" data-format="p">P</button>
                  <button type="button" data-format="strong">Bold</button>
                  <button type="button" data-format="em">Italic</button>
                  <button type="button" data-format="ul">List</button>
                  <button type="button" data-format="ol">Numbered List</button>
                  <button type="button" data-format="li">List Item</button>
                  <button type="button" data-format="a">Link</button>
                  <button type="button" data-format="code">Code</button>
                </div>
                <textarea
                  id="blog-content"
                  required
                  placeholder="<p>Blog post full content with HTML formatting</p>"
                ></textarea>
              </div>
            </div>
          </div>

          <div class="btn-group">
            <button type="button" id="preview-blog-btn" class="secondary">
              Preview JSON
            </button>
            <button type="button" id="save-blog-btn">
              Generate & Download JSON Files
            </button>
            <button type="button" id="cancel-blog-btn" class="danger">
              Cancel
            </button>
          </div>
        </form>

        <div id="blog-preview" class="preview" style="display: none">
          <h3>JSON Preview</h3>
          <h4>blogs.json entry:</h4>
          <pre id="blog-meta-preview"></pre>

          <h4>blogs/[id].json file:</h4>
          <pre id="blog-content-preview"></pre>

          <div class="btn-group">
            <button id="close-blog-preview-btn" class="secondary">
              Close Preview
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
      // Cache for storing loaded data
      const dataCache = {
        projectsMetadata: null,
        blogMetadata: null,
        projects: {},
        blogs: {},
      };

      // DOM Elements
      const projectsList = document.getElementById("projects-list");
      const blogsList = document.getElementById("blogs-list");
      const projectForm = document.getElementById("project-form");
      const blogForm = document.getElementById("blog-form");
      const projectFormContainer = document.getElementById(
        "project-form-container"
      );
      const blogFormContainer = document.getElementById("blog-form-container");
      const notification = document.getElementById("notification");

      // Tab Switching
      document.querySelectorAll(".tab").forEach((tab) => {
        tab.addEventListener("click", () => {
          // Update tab buttons
          document
            .querySelectorAll(".tab")
            .forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");

          // Show the corresponding tab content
          document
            .querySelectorAll(".tab-content")
            .forEach((content) => content.classList.remove("active"));
          document
            .getElementById(`${tab.dataset.tab}-tab`)
            .classList.add("active");
        });
      });

      // Show notification
      function showNotification(message, isError = false) {
        notification.textContent = message;
        notification.className = "notification" + (isError ? " error" : "");
        notification.classList.add("show");

        setTimeout(() => {
          notification.classList.remove("show");
        }, 3000);
      }

      // Load JSON data
      async function loadData(filename) {
        try {
          const response = await fetch(`data/${filename}.json`);

          if (!response.ok) {
            throw new Error(
              `Failed to load ${filename}.json: ${response.status}`
            );
          }

          return await response.json();
        } catch (error) {
          console.error(`Error loading ${filename}.json:`, error);
          showNotification(
            `Error loading ${filename}.json: ${error.message}`,
            true
          );
          return null;
        }
      }

      // Load projects
      async function loadProjects() {
        if (dataCache.projectsMetadata) {
          return dataCache.projectsMetadata;
        }

        const data = await loadData("projects");
        if (data) {
          dataCache.projectsMetadata = data;
        }
        return data;
      }

      // Load blogs
      async function loadBlogs() {
        if (dataCache.blogMetadata) {
          return dataCache.blogMetadata;
        }

        const data = await loadData("blogs");
        if (data) {
          dataCache.blogMetadata = data;
        }
        return data;
      }

      // Load individual project
      async function loadProject(id) {
        if (dataCache.projects[id]) {
          return dataCache.projects[id];
        }

        const data = await loadData(`projects/${id}`);
        if (data) {
          dataCache.projects[id] = data;
        }
        return data;
      }

      // Load individual blog
      async function loadBlog(id) {
        if (dataCache.blogs[id]) {
          return dataCache.blogs[id];
        }

        const data = await loadData(`blogs/${id}`);
        if (data) {
          dataCache.blogs[id] = data;
        }
        return data;
      }

      // Display projects list
      async function displayProjects() {
        projectsList.innerHTML = "<p>Loading projects...</p>";

        const projectsData = await loadProjects();

        if (
          !projectsData ||
          !projectsData.projects ||
          projectsData.projects.length === 0
        ) {
          projectsList.innerHTML = "<p>No projects found.</p>";
          return;
        }

        let html = '<select id="project-select" style="margin-bottom: 15px;">';
        projectsData.projects.forEach((project) => {
          html += `<option value="${project.id}">${project.title}</option>`;
        });
        html += "</select>";

        html += "<div>";
        projectsData.projects.forEach((project) => {
          html += `
          <div class="list-item">
            <h3>${project.title}</h3>
            <p><strong>ID:</strong> ${project.id}</p>
            <p>${project.description}</p>
            <div class="tags">
              ${project.tags
                .map((tag) => `<span class="tag-pill">${tag}</span>`)
                .join("")}
            </div>
            ${project.featured ? "<p><strong>✓ Featured</strong></p>" : ""}
          </div>
        `;
        });
        html += "</div>";

        projectsList.innerHTML = html;
      }

      // Display blogs list
      async function displayBlogs() {
        blogsList.innerHTML = "<p>Loading blog posts...</p>";

        const blogsData = await loadBlogs();

        if (!blogsData || !blogsData.posts || blogsData.posts.length === 0) {
          blogsList.innerHTML = "<p>No blog posts found.</p>";
          return;
        }

        let html = '<select id="blog-select" style="margin-bottom: 15px;">';
        blogsData.posts.forEach((post) => {
          html += `<option value="${post.id}">${post.title}</option>`;
        });
        html += "</select>";

        html += "<div>";
        blogsData.posts.forEach((post) => {
          html += `
          <div class="list-item">
            <h3>${post.title}</h3>
            <p><strong>ID:</strong> ${post.id}</p>
            <p><strong>Date:</strong> ${post.date}</p>
            <p>${post.excerpt || ""}</p>
            <div class="tags">
              ${post.tags
                .map((tag) => `<span class="tag-pill">${tag}</span>`)
                .join("")}
            </div>
          </div>
        `;
        });
        html += "</div>";

        blogsList.innerHTML = html;
      }

      // Initialize page
      async function init() {
        // Load projects and blogs lists
        await displayProjects();
        await displayBlogs();

        // Setup event listeners
        setupEventListeners();
      }

      // Setup event listeners
      function setupEventListeners() {
        // Projects
        document
          .getElementById("new-project-btn")
          .addEventListener("click", createNewProject);
        document
          .getElementById("load-project-btn")
          .addEventListener("click", loadSelectedProject);
        document
          .getElementById("preview-project-btn")
          .addEventListener("click", previewProject);
        document
          .getElementById("save-project-btn")
          .addEventListener("click", saveProject);
        document
          .getElementById("cancel-project-btn")
          .addEventListener("click", cancelProject);
        document
          .getElementById("close-project-preview-btn")
          .addEventListener("click", closeProjectPreview);
        document
          .getElementById("add-project-tag")
          .addEventListener("click", addProjectTag);

        // Add tag on Enter key
        document
          .getElementById("project-tags-input")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              addProjectTag();
            }
          });

        // Blogs
        document
          .getElementById("new-blog-btn")
          .addEventListener("click", createNewBlog);
        document
          .getElementById("load-blog-btn")
          .addEventListener("click", loadSelectedBlog);
        document
          .getElementById("preview-blog-btn")
          .addEventListener("click", previewBlog);
        document
          .getElementById("save-blog-btn")
          .addEventListener("click", saveBlog);
        document
          .getElementById("cancel-blog-btn")
          .addEventListener("click", cancelBlog);
        document
          .getElementById("close-blog-preview-btn")
          .addEventListener("click", closeBlogPreview);
        document
          .getElementById("add-blog-tag")
          .addEventListener("click", addBlogTag);

        // Add tag on Enter key
        document
          .getElementById("blog-tags-input")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              addBlogTag();
            }
          });

        // Editor toolbar buttons
        document.querySelectorAll(".toolbar button").forEach((button) => {
          button.addEventListener("click", () => {
            const format = button.dataset.format;
            const targetId =
              button.closest(".tab-content").id === "projects-tab"
                ? "project-content"
                : "blog-content";
            const textarea = document.getElementById(targetId);

            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            let replacement = "";

            switch (format) {
              case "h2":
                replacement = `<h2>${selectedText || "Heading 2"}</h2>`;
                break;
              case "h3":
                replacement = `<h3>${selectedText || "Heading 3"}</h3>`;
                break;
              case "p":
                replacement = `<p>${selectedText || "Paragraph text"}</p>`;
                break;
              case "strong":
                replacement = `<strong>${selectedText || "Bold text"}</strong>`;
                break;
              case "em":
                replacement = `<em>${selectedText || "Italic text"}</em>`;
                break;
              case "ul":
                replacement = `<ul>\n  <li>${
                  selectedText || "List item"
                }</li>\n</ul>`;
                break;
              case "ol":
                replacement = `<ol>\n  <li>${
                  selectedText || "List item"
                }</li>\n</ol>`;
                break;
              case "li":
                replacement = `<li>${selectedText || "List item"}</li>`;
                break;
              case "a":
                const url = prompt("Enter URL:", "https://");
                if (url) {
                  replacement = `<a href="${url}">${selectedText || url}</a>`;
                } else {
                  return;
                }
                break;
              case "code":
                replacement = `<code>${selectedText || "Code"}</code>`;
                break;
            }

            textarea.focus();
            document.execCommand("insertText", false, replacement);

            // Fallback for browsers that don't support execCommand
            if (
              textarea.value.substring(start, start + replacement.length) !==
              replacement
            ) {
              const value = textarea.value;
              textarea.value =
                value.substring(0, start) + replacement + value.substring(end);
            }
          });
        });
      }

      // Project Functions
      function createNewProject() {
        // Reset form
        projectForm.reset();
        document.getElementById("project-tags-container").innerHTML = "";
        document.getElementById("project-form-title").textContent =
          "New Project";

        // Set today's date
        const today = new Date().toISOString().split("T")[0];
        document.getElementById("project-date").value = today;

        // Show form
        projectFormContainer.style.display = "block";
        document.getElementById("project-preview").style.display = "none";
        projectsList.style.display = "none";
        document.querySelector("#projects-tab .btn-group").style.display =
          "none";
      }

      async function loadSelectedProject() {
        const select = document.getElementById("project-select");
        if (!select) {
          showNotification("No projects available to load", true);
          return;
        }

        const projectId = select.value;
        if (!projectId) {
          showNotification("Please select a project to load", true);
          return;
        }

        // Get project metadata
        const projectsData = await loadProjects();
        const projectMeta = projectsData.projects.find(
          (p) => p.id === projectId
        );

        if (!projectMeta) {
          showNotification(
            `Project with ID ${projectId} not found in projects.json`,
            true
          );
          return;
        }

        // Get project content
        const projectContent = await loadProject(projectId);

        if (!projectContent) {
          showNotification(
            `Could not load content for project ${projectId}`,
            true
          );
          return;
        }

        // Fill the form
        document.getElementById(
          "project-form-title"
        ).textContent = `Edit Project: ${projectMeta.title}`;
        document.getElementById("project-id").value = projectMeta.id;
        document.getElementById("project-title").value = projectMeta.title;
        document.getElementById("project-description").value =
          projectMeta.description;
        document.getElementById("project-featured").checked =
          projectMeta.featured || false;

        // Fill tags
        const tagsContainer = document.getElementById("project-tags-container");
        tagsContainer.innerHTML = "";
        projectMeta.tags.forEach((tag) => {
          addTagElement(tag, "project");
        });

        // Fill content fields
        if (projectContent.date) {
          document.getElementById("project-date").value = formatDateForInput(
            projectContent.date
          );
        }

        if (projectContent.github) {
          document.getElementById("project-github").value =
            projectContent.github;
        }

        if (projectContent.live) {
          document.getElementById("project-live").value = projectContent.live;
        }

        document.getElementById("project-content").value =
          projectContent.content || "";

        // Show form
        projectFormContainer.style.display = "block";
        document.getElementById("project-preview").style.display = "none";
        projectsList.style.display = "none";
        document.querySelector("#projects-tab .btn-group").style.display =
          "none";

        showNotification(`Loaded project: ${projectMeta.title}`);
      }

      function formatDateForInput(dateString) {
        // Try to parse the date string
        const date = new Date(dateString);
        if (isNaN(date.getTime())) {
          // If parsing fails, return the original string
          return dateString;
        }

        // Format as YYYY-MM-DD for input[type="date"]
        return date.toISOString().split("T")[0];
      }

      function addProjectTag() {
        const input = document.getElementById("project-tags-input");
        const tag = input.value.trim();

        if (tag) {
          addTagElement(tag, "project");
          input.value = "";
        }
      }

      function addTagElement(tag, type) {
        const container = document.getElementById(`${type}-tags-container`);

        // Check if tag already exists
        const existingTags = container.querySelectorAll(".tag-text");
        for (const existingTag of existingTags) {
          if (existingTag.textContent === tag) {
            return; // Don't add duplicate tags
          }
        }

        const tagElement = document.createElement("div");
        tagElement.className = "tag";

        const tagText = document.createElement("span");
        tagText.className = "tag-text";
        tagText.textContent = tag;

        const removeButton = document.createElement("span");
        removeButton.className = "tag-remove";
        removeButton.textContent = "×";
        removeButton.addEventListener("click", () => {
          container.removeChild(tagElement);
        });

        tagElement.appendChild(tagText);
        tagElement.appendChild(removeButton);
        container.appendChild(tagElement);
      }

      function getProjectTags() {
        const tags = [];
        document
          .querySelectorAll("#project-tags-container .tag-text")
          .forEach((tag) => {
            tags.push(tag.textContent);
          });
        return tags;
      }

      function previewProject() {
        // Get form data
        const id = document.getElementById("project -id").value.trim();
        const title = document.getElementById("project-title").value.trim();
        const description = document
          .getElementById("project-description")
          .value.trim();
        const featured = document.getElementById("project-featured").checked;
        const tags = getProjectTags();
        const date = document.getElementById("project-date").value;
        const github = document.getElementById("project-github").value.trim();
        const live = document.getElementById("project-live").value.trim();
        const content = document.getElementById("project-content").value.trim();

        // Validate required fields
        if (
          !id ||
          !title ||
          !description ||
          tags.length === 0 ||
          !date ||
          !content
        ) {
          showNotification("Please fill all required fields", true);
          return;
        }

        // Create metadata object (for projects.json)
        const metadata = {
          id,
          title,
          description,
          featured,
          tags,
        };

        // Create full content object (for projects/[id].json)
        const projectData = {
          id,
          title,
          description,
          date,
          tags,
        };

        // Add optional fields
        if (github) projectData.github = github;
        if (live) projectData.live = live;

        // Add content
        projectData.content = content;

        // Display preview
        document.getElementById("project-meta-preview").textContent =
          JSON.stringify(metadata, null, 2);
        document.getElementById("project-content-preview").textContent =
          JSON.stringify(projectData, null, 2);

        // Show preview container
        document.getElementById("project-preview").style.display = "block";
      }

      function saveProject() {
        // First preview to validate
        previewProject();

        // Check if preview is displayed (validation passed)
        if (
          document.getElementById("project-preview").style.display !== "block"
        ) {
          return;
        }

        // Get the JSON data
        const metadataJson = document.getElementById(
          "project-meta-preview"
        ).textContent;
        const contentJson = document.getElementById(
          "project-content-preview"
        ).textContent;

        // Parse metadata to get ID
        const metadata = JSON.parse(metadataJson);
        const id = metadata.id;

        // Download metadata updates for projects.json
        downloadProjectsMetadata(metadata);

        // Download individual project file
        downloadFile(`${id}.json`, contentJson);

        showNotification(`Generated JSON files for project: ${metadata.title}`);
      }

      async function downloadProjectsMetadata(newProject) {
        try {
          // Load current projects
          const projectsData = await loadProjects();

          if (!projectsData) {
            // If we couldn't load existing data, create a new projects structure
            const newData = {
              projects: [newProject],
            };
            downloadFile("projects.json", JSON.stringify(newData, null, 2));
            return;
          }

          // Check if this project already exists
          const existingIndex = projectsData.projects.findIndex(
            (p) => p.id === newProject.id
          );

          if (existingIndex !== -1) {
            // Update existing project
            projectsData.projects[existingIndex] = newProject;
          } else {
            // Add new project
            projectsData.projects.push(newProject);
          }

          // Download updated projects.json
          downloadFile("projects.json", JSON.stringify(projectsData, null, 2));
        } catch (error) {
          console.error("Error updating projects metadata:", error);
          showNotification("Error updating projects metadata", true);
        }
      }

      function cancelProject() {
        projectFormContainer.style.display = "none";
        projectsList.style.display = "block";
        document.querySelector("#projects-tab .btn-group").style.display =
          "flex";
      }

      function closeProjectPreview() {
        document.getElementById("project-preview").style.display = "none";
      }

      // Blog Functions
      function createNewBlog() {
        // Reset form
        blogForm.reset();
        document.getElementById("blog-tags-container").innerHTML = "";
        document.getElementById("blog-form-title").textContent =
          "New Blog Post";

        // Set today's date
        const today = new Date();
        const options = { year: "numeric", month: "long", day: "numeric" };
        document.getElementById("blog-date").value = today.toLocaleDateString(
          "en-US",
          options
        );

        // Show form
        blogFormContainer.style.display = "block";
        document.getElementById("blog-preview").style.display = "none";
        blogsList.style.display = "none";
        document.querySelector("#blogs-tab .btn-group").style.display = "none";
      }

      async function loadSelectedBlog() {
        const select = document.getElementById("blog-select");
        if (!select) {
          showNotification("No blog posts available to load", true);
          return;
        }

        const blogId = select.value;
        if (!blogId) {
          showNotification("Please select a blog post to load", true);
          return;
        }

        // Get blog metadata
        const blogsData = await loadBlogs();
        const blogMeta = blogsData.posts.find((p) => p.id === blogId);

        if (!blogMeta) {
          showNotification(
            `Blog with ID ${blogId} not found in blogs.json`,
            true
          );
          return;
        }

        // Get blog content
        const blogContent = await loadBlog(blogId);

        if (!blogContent) {
          showNotification(`Could not load content for blog ${blogId}`, true);
          return;
        }

        // Fill the form
        document.getElementById(
          "blog-form-title"
        ).textContent = `Edit Blog Post: ${blogMeta.title}`;
        document.getElementById("blog-id").value = blogMeta.id;
        document.getElementById("blog-title").value = blogMeta.title;
        document.getElementById("blog-date").value = blogMeta.date;
        document.getElementById("blog-author").value = blogMeta.author || "";
        document.getElementById("blog-excerpt").value = blogMeta.excerpt || "";

        // Fill tags
        const tagsContainer = document.getElementById("blog-tags-container");
        tagsContainer.innerHTML = "";
        blogMeta.tags.forEach((tag) => {
          addTagElement(tag, "blog");
        });

        // Fill content field
        document.getElementById("blog-content").value =
          blogContent.content || "";

        // Show form
        blogFormContainer.style.display = "block";
        document.getElementById("blog-preview").style.display = "none";
        blogsList.style.display = "none";
        document.querySelector("#blogs-tab .btn-group").style.display = "none";

        showNotification(`Loaded blog post: ${blogMeta.title}`);
      }

      function addBlogTag() {
        const input = document.getElementById("blog-tags-input");
        const tag = input.value.trim();

        if (tag) {
          addTagElement(tag, "blog");
          input.value = "";
        }
      }

      function getBlogTags() {
        const tags = [];
        document
          .querySelectorAll("#blog-tags-container .tag-text")
          .forEach((tag) => {
            tags.push(tag.textContent);
          });
        return tags;
      }

      function previewBlog() {
        // Get form data
        const id = document.getElementById("blog-id").value.trim();
        const title = document.getElementById("blog-title").value.trim();
        const date = document.getElementById("blog-date").value.trim();
        const author = document.getElementById("blog-author").value.trim();
        const excerpt = document.getElementById("blog-excerpt").value.trim();
        const tags = getBlogTags();
        const content = document.getElementById("blog-content").value.trim();

        // Validate required fields
        if (
          !id ||
          !title ||
          !date ||
          !author ||
          !excerpt ||
          tags.length === 0 ||
          !content
        ) {
          showNotification("Please fill all required fields", true);
          return;
        }

        // Create metadata object (for blogs.json)
        const metadata = {
          id,
          title,
          date,
          author,
          excerpt,
          tags,
        };

        // Create full content object (for blogs/[id].json)
        const blogData = {
          id,
          title,
          date,
          author,
          tags,
          content,
        };

        // Display preview
        document.getElementById("blog-meta-preview").textContent =
          JSON.stringify(metadata, null, 2);
        document.getElementById("blog-content-preview").textContent =
          JSON.stringify(blogData, null, 2);

        // Show preview container
        document.getElementById("blog-preview").style.display = "block";
      }

      function saveBlog() {
        // First preview to validate
        previewBlog();

        // Check if preview is displayed (validation passed)
        if (document.getElementById("blog-preview").style.display !== "block") {
          return;
        }

        // Get the JSON data
        const metadataJson =
          document.getElementById("blog-meta-preview").textContent;
        const contentJson = document.getElementById(
          "blog-content-preview"
        ).textContent;

        // Parse metadata to get ID
        const metadata = JSON.parse(metadataJson);
        const id = metadata.id;

        // Download metadata updates for blogs.json
        downloadBlogsMetadata(metadata);

        // Download individual blog file
        downloadFile(`${id}.json`, contentJson);

        showNotification(
          `Generated JSON files for blog post: ${metadata.title}`
        );
      }

      async function downloadBlogsMetadata(newBlog) {
        try {
          // Load current blogs
          const blogsData = await loadBlogs();

          if (!blogsData) {
            // If we couldn't load existing data, create a new blogs structure
            const newData = {
              posts: [newBlog],
            };
            downloadFile("blogs.json", JSON.stringify(newData, null, 2));
            return;
          }

          // Check if this blog already exists
          const existingIndex = blogsData.posts.findIndex(
            (p) => p.id === newBlog.id
          );

          if (existingIndex !== -1) {
            // Update existing blog
            blogsData.posts[existingIndex] = newBlog;
          } else {
            // Add new blog
            blogsData.posts.push(newBlog);
          }

          // Download updated blogs.json
          downloadFile("blogs.json", JSON.stringify(blogsData, null, 2));
        } catch (error) {
          console.error("Error updating blogs metadata:", error);
          showNotification("Error updating blogs metadata", true);
        }
      }

      function downloadFile(filename, content) {
        const blob = new Blob([content], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function cancelBlog() {
        blogFormContainer.style.display = "none";
        blogsList.style.display = "block";
        document.querySelector("#blogs-tab .btn-group").style.display = "flex";
      }

      function closeBlogPreview() {
        document.getElementById("blog-preview").style.display = "none";
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
